# æ€ªç‰©AIç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„æ€ªç‰©AIé€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š
- åŸå ¡è¡€é‡ç®¡ç†å’Œé˜µè¥æ ‡è®°
- æ€ªç‰©è‡ªåŠ¨ç›®æ ‡æœç´¢å’Œæ”»å‡»
- ç›®æ ‡æ­»äº¡åé‡æ–°å¯»æ‰¾ç›®æ ‡
- ä¼˜å…ˆæ”»å‡»æ€ªç‰©ï¼Œå…¶æ¬¡æ”»å‡»åŸå ¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **Castle.ts** - åŸå ¡è„šæœ¬
   - ç®¡ç†åŸå ¡è¡€é‡ã€é˜²å¾¡åŠ›ã€å›è¡€é€Ÿåº¦
   - æ”¯æŒé˜µè¥æ ‡è®°ï¼ˆç©å®¶/æ•Œæ–¹ï¼‰
   - æä¾›å—ä¼¤ã€æ²»ç–—ã€æ‘§æ¯äº‹ä»¶

2. **MonsterManager.ts** - æ€ªç‰©ç®¡ç†å™¨
   - ç®¡ç†åœºæ™¯ä¸­æ‰€æœ‰æ€ªç‰©å’ŒåŸå ¡
   - æä¾›ç›®æ ‡æœç´¢åŠŸèƒ½
   - è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€æ€ªç‰©å’ŒåŸå ¡

3. **BaseMonster.ts** - æ€ªç‰©åŸºç±»ï¼ˆå·²æ›´æ–°ï¼‰
   - æ”¯æŒæ”»å‡»åŸå ¡å’Œæ€ªç‰©
   - è‡ªåŠ¨æ³¨å†Œåˆ°MonsterManager
   - æ™ºèƒ½ç›®æ ‡æœç´¢é€»è¾‘

4. **RockMonster.ts** - Rockæ€ªç‰©ï¼ˆå·²æ›´æ–°ï¼‰
   - æ”¯æŒæ”»å‡»ä¸åŒç±»å‹ç›®æ ‡
   - ç»§æ‰¿å®Œæ•´AIè¡Œä¸º

## ğŸ¯ AIè¡Œä¸ºé€»è¾‘

### ç›®æ ‡æœç´¢ä¼˜å…ˆçº§
1. **ä¼˜å…ˆæ”»å‡»æ•Œæ–¹æ€ªç‰©**
   - æŒ‰è·ç¦»æ’åºï¼Œæ”»å‡»æœ€è¿‘çš„æ•Œæ–¹æ€ªç‰©
   - æ€ªç‰©æ­»äº¡åè‡ªåŠ¨å¯»æ‰¾ä¸‹ä¸€ä¸ªç›®æ ‡

2. **å…¶æ¬¡æ”»å‡»æ•Œæ–¹åŸå ¡**
   - å¦‚æœæ²¡æœ‰æ•Œæ–¹æ€ªç‰©ï¼Œæ”»å‡»æ•Œæ–¹åŸå ¡
   - åŸå ¡è¢«æ‘§æ¯ååœæ­¢æ”»å‡»

### çŠ¶æ€æœºè¡Œä¸º
- **IDLE**: å¯»æ‰¾ç›®æ ‡
- **MOVING**: å‘ç›®æ ‡ç§»åŠ¨
- **ATTACKING**: åœ¨æ”»å‡»èŒƒå›´å†…æ”»å‡»ç›®æ ‡
- **DYING**: æ­»äº¡åŠ¨ç”»æ’­æ”¾ä¸­

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åœºæ™¯è®¾ç½®

åœ¨åœºæ™¯ä¸­åˆ›å»ºä»¥ä¸‹èŠ‚ç‚¹ï¼š
```
Scene
â”œâ”€â”€ BattleField
â”‚   â”œâ”€â”€ spawnArea (ç©å®¶æ€ªç‰©ç”ŸæˆåŒºåŸŸ)
â”‚   â””â”€â”€ Rock (æ€ªç‰©èŠ‚ç‚¹ï¼ŒæŒ‚è½½RockMonsterè„šæœ¬)
â”œâ”€â”€ castle-self (ç©å®¶åŸå ¡ï¼Œéœ€è¦æŒ‚è½½Castleè„šæœ¬)
â”œâ”€â”€ castle-enemy (æ•Œæ–¹åŸå ¡ï¼Œéœ€è¦æŒ‚è½½Castleè„šæœ¬)
â””â”€â”€ GameManager (æŒ‚è½½GameMainManagerè„šæœ¬)
```

### 2. ç»„ä»¶é…ç½®

#### Castleç»„ä»¶é…ç½®
```typescript
// åœ¨åœºæ™¯ä¸­ä¸ºåŸå ¡èŠ‚ç‚¹æ·»åŠ Castleè„šæœ¬
// ç©å®¶åŸå ¡
castle-self.isPlayerCamp = true;
castle-self.castleLevel = 1;

// æ•Œæ–¹åŸå ¡  
castle-enemy.isPlayerCamp = false;
castle-enemy.castleLevel = 1;
```

#### æ€ªç‰©é…ç½®
```typescript
// RockMonsterä¼šè‡ªåŠ¨æ³¨å†Œåˆ°MonsterManager
// è®¾ç½®é˜µè¥
rockMonster.isPlayerCamp = true; // ç©å®¶é˜µè¥
// æˆ–
rockMonster.isPlayerCamp = false; // æ•Œæ–¹é˜µè¥
```

### 3. ä»£ç ç¤ºä¾‹

#### åˆ›å»ºæ•Œæ–¹æ€ªç‰©
```typescript
// åœ¨RockCardæˆ–å…¶ä»–åœ°æ–¹åˆ›å»ºæ•Œæ–¹æ€ªç‰©
const enemyRock = this.createRockMonster();
enemyRock.isPlayerCamp = false; // è®¾ç½®ä¸ºæ•Œæ–¹
// MonsterManagerä¼šè‡ªåŠ¨æ³¨å†Œè¿™ä¸ªæ€ªç‰©
```

#### æ‰‹åŠ¨è®¾ç½®ç›®æ ‡
```typescript
// å¦‚æœéœ€è¦æ‰‹åŠ¨è®¾ç½®ç›®æ ‡
const manager = MonsterManager.getInstance();
const target = manager.findNearestEnemyTarget(monster);
if (target) {
    monster.setTarget(target);
}
```

## ğŸ”§ ç³»ç»Ÿç‰¹æ€§

### è‡ªåŠ¨ç®¡ç†
- æ€ªç‰©è‡ªåŠ¨æ³¨å†Œåˆ°MonsterManager
- æ­»äº¡çš„æ€ªç‰©è‡ªåŠ¨ä»ç®¡ç†å™¨ä¸­ç§»é™¤
- æ‘§æ¯çš„åŸå ¡è‡ªåŠ¨ä»ç®¡ç†å™¨ä¸­ç§»é™¤

### æ™ºèƒ½ç›®æ ‡æœç´¢
- ä¼˜å…ˆæ”»å‡»è·ç¦»æœ€è¿‘çš„æ•Œæ–¹æ€ªç‰©
- æ²¡æœ‰æ€ªç‰©æ—¶æ”»å‡»æ•Œæ–¹åŸå ¡
- ç›®æ ‡æ­»äº¡åè‡ªåŠ¨é‡æ–°æœç´¢

### äº‹ä»¶ç³»ç»Ÿ
- æ€ªç‰©æ”»å‡»äº‹ä»¶ï¼š`MONSTER_ATTACK_PERFORMED`
- æ€ªç‰©å—ä¼¤äº‹ä»¶ï¼š`MONSTER_DAMAGE_TAKEN`
- æ€ªç‰©æ­»äº¡äº‹ä»¶ï¼š`MONSTER_DEATH`
- åŸå ¡å—ä¼¤äº‹ä»¶ï¼š`CASTLE_DAMAGE_TAKEN`
- åŸå ¡æ‘§æ¯äº‹ä»¶ï¼š`CASTLE_DESTROYED`

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

GameMainManageråŒ…å«æµ‹è¯•æ–¹æ³•ï¼š
- `testMonsterSystem()` - æµ‹è¯•åŸºç¡€æ€ªç‰©åŠŸèƒ½
- `testMonsterAI()` - æµ‹è¯•AIç›®æ ‡æœç´¢åŠŸèƒ½

## ğŸ“Š è°ƒè¯•ä¿¡æ¯

ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼š
- æ€ªç‰©æ³¨å†Œ/æ³¨é”€ä¿¡æ¯
- ç›®æ ‡æœç´¢ç»“æœ
- æ”»å‡»è¡Œä¸ºæ—¥å¿—
- çŠ¶æ€åˆ‡æ¢ä¿¡æ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åŸå ¡ç»„ä»¶é…ç½®**
   - éœ€è¦åœ¨åœºæ™¯ä¸­æ‰‹åŠ¨ä¸ºåŸå ¡èŠ‚ç‚¹æ·»åŠ Castleè„šæœ¬ç»„ä»¶
   - ç¡®ä¿åŸå ¡èŠ‚ç‚¹åç§°ä¸º `castle-self` å’Œ `castle-enemy`

2. **MonsterManageråˆå§‹åŒ–**
   - MonsterManagerä¼šåœ¨GameMainManagerä¸­è‡ªåŠ¨åˆ›å»º
   - æ€ªç‰©ä¼šåœ¨åˆ›å»ºæ—¶è‡ªåŠ¨æ³¨å†Œ

3. **æ€§èƒ½è€ƒè™‘**
   - ç›®æ ‡æœç´¢æœ‰æœ€å¤§è·ç¦»é™åˆ¶ï¼ˆé»˜è®¤2000åƒç´ ï¼‰
   - å¯ä»¥é€šè¿‡MonsterManager.maxSearchDistanceè°ƒæ•´

## ğŸ”„ æ‰©å±•æ€§

### æ·»åŠ æ–°æ€ªç‰©ç±»å‹
```typescript
@regClass()
export class SkeletonMonster extends BaseMonster {
    protected initializeMonster(): void {
        this.monsterStats = {
            speed: 120,
            attackPower: 15,
            attackSpeed: 1000,
            attackRange: 150,
            maxHealth: 80
        };
    }
    
    protected getAnimationManagerComponent(): any {
        return this.owner.getComponent(SkeletonAnimationManager);
    }
}
```

### è‡ªå®šä¹‰AIè¡Œä¸º
```typescript
// é‡å†™ç›®æ ‡æœç´¢é€»è¾‘
protected findTarget(): BaseMonster | Castle | null {
    // è‡ªå®šä¹‰æœç´¢é€»è¾‘
    const manager = MonsterManager.getInstance();
    return manager.findNearestEnemyTarget(this);
}
```

## ğŸ® æ¸¸æˆæµç¨‹

1. æ¸¸æˆå¼€å§‹æ—¶ï¼ŒMonsterManageråˆå§‹åŒ–
2. åŸå ¡è‡ªåŠ¨æ³¨å†Œåˆ°ç®¡ç†å™¨
3. ç©å®¶ä½¿ç”¨å¡ç‰Œç”Ÿæˆæ€ªç‰©
4. æ€ªç‰©è‡ªåŠ¨æ³¨å†Œå¹¶å¼€å§‹å¯»æ‰¾ç›®æ ‡
5. æ€ªç‰©æŒ‰ä¼˜å…ˆçº§æ”»å‡»æ•Œæ–¹å•ä½
6. ç›®æ ‡æ­»äº¡åé‡æ–°æœç´¢ç›®æ ‡
7. æ¸¸æˆç»§ç»­ç›´åˆ°ä¸€æ–¹åŸå ¡è¢«æ‘§æ¯

è¿™ä¸ªç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æ€ªç‰©AIåŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨ç›®æ ‡æœç´¢ã€æ™ºèƒ½æ”»å‡»è¡Œä¸ºå’Œçµæ´»çš„æ‰©å±•æ€§ã€‚
